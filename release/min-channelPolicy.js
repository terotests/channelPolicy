(function(){var t={},n=function(){var n=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.constructClientToServer=function(t){var n=t.data;t.last_sent||(t.last_sent=[]);var e=t.last_sent[1]||0,r=n._journal.length;if(t.last_update){var o=t.last_update[1]||0;if(o>=r)return null}if(e==r)return null;console.log("clientToServer"),console.log(t.last_update),console.log(e,r),t.last_sent[0]=e,t.last_sent[1]=r;var a={id:this.guid(),c:n._journal.slice(e,r),start:e,end:r,version:t.version};if(t.client)for(var i=0;i<a.c.length;i++){var s=a.c[i];a.c[i]=t.client._transformCmdFromNs(s)}return a},t.constructServerToClient=function(t){var n=t.data;t.last_update||(t.last_update=[]);var e=t.last_update[1]||0,r=n._journal.length;return e==r?null:(t.last_update[0]=e,t.last_update[1]=r,{c:n._journal.slice(e,r),start:e,end:r,version:t.version})},t.deltaClientToServer=function(t,n){if(t){n._done||(n._done={}),console.log("Processing client frame"),console.log(JSON.stringify(t));try{if(!t.id)return;if(n._done[t.id])return res;n._done[t.id]=!0;for(var e=n.data,r=[],o=0;o<t.c.length;o++){var a=t.c[o],i=e.execCmd(a);i!==!0&&r.push(i)}var s={errors:r};return console.log(JSON.stringify(s)),s}catch(l){return l.message}}},t.deltaServerToClient=function(t,n){if(t){var e=n.data;n.last_update||(n.last_update=[]);var r={goodCnt:0,oldCnt:0,newCnt:0,reverseCnt:0};console.log("deltaServerToClient"),console.log(n.last_update);var o=t.start;if(n.needsRefresh)return void console.log("** client needs refresh **");if(t.start>e._journal.length)return console.log("--- setting refresh on because of ---- "),console.log(" updateFrame.start > data._journal.length "),n.needsRefresh=!0,r.fail=!0,r;if(n.client)for(var a=t.start;a<t.end;a++){var i=t.c[a-t.start];t.c[a-t.start]=n.client._transformCmdToNs(i)}for(var a=t.start;a<t.end;a++){var s=e.getJournalCmd(a),i=t.c[a-t.start],l=!0;if(s){for(var c=0;4>=c;c++)s[c]!=i[c]&&(l=!1,console.log("was not the same"),console.log(i[c],"vs",s[c]));if(!l){e.reverseToLine(o);for(var a=o;a<t.end;a++){var i=t.c[a-t.start],f=e.execCmd(i,!0);if(f!==!0)return console.log("--- setting refresh on because of ---- "),console.log(JSON.stringify(f)),n.needsRefresh=!0,r.fail=!0,r.reason=f,r;r.reverseCnt++}return n.last_update[0]=t.start,n.last_update[1]=t.end,r}o=a,r.goodCnt++,r.oldCnt++}else{var f=e.execCmd(i,!0);if(f!==!0)return console.log("--- setting refresh on because of ---- "),console.log(JSON.stringify(f)),n.needsRefresh=!0,r.fail=!0,r.reason=f,r;o=a,r.goodCnt++,r.newCnt++}}return n.last_update[0]=t.start,n.last_update[1]=t.end,r}}}(this)},e=function(t,n,r,o,a,i,s,l){var c,f=this;if(!(f instanceof e))return new e(t,n,r,o,a,i,s,l);var u=[t,n,r,o,a,i,s,l];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){c=t.apply(f,u)}),"function"==typeof c){if(c._classInfo.name!=e._classInfo.name)return new c(t,n,r,o,a,i,s,l)}else if(c)return c;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,u)}):"function"==typeof f.init&&f.init.apply(f,u)};e._classInfo={name:"_chPolicy"},e.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t._chPolicy=e,this._chPolicy=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._chPolicy=e:this._chPolicy=e}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},e=function(t,n,r,o,a,i,s,l){var c,f=this;if(!(f instanceof e))return new e(t,n,r,o,a,i,s,l);var u=[t,n,r,o,a,i,s,l];if(f.__factoryClass)if(f.__factoryClass.forEach(function(t){c=t.apply(f,u)}),"function"==typeof c){if(c._classInfo.name!=e._classInfo.name)return new c(t,n,r,o,a,i,s,l)}else if(c)return c;f.__traitInit?f.__traitInit.forEach(function(t){t.apply(f,u)}):"function"==typeof f.init&&f.init.apply(f,u)};e._classInfo={name:"channelPolicyModule"},e.prototype=new n,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());