(function(){var t={},n=function(){var n=function(){!function(t){t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)}}(this),function(t){t.constructClientToServer=function(t){var n=t.data;t.last_sent||(t.last_sent=[]);var e=t.last_sent[1]||0,r=n._journal.length;if(e==r)return null;t.last_sent[0]=e,t.last_sent[1]=r;var i={id:this.guid(),c:n._journal.slice(e,r),start:e,end:r,version:t.version};if(t.client)for(var a=0;a<i.c.length;a++){var o=i.c[a];i.c[a]=t.client._transformCmdFromNs(o)}return i},t.constructServerToClient=function(t){var n=t.data;t.last_update||(t.last_update=[]);var e=t.last_update[1]||0,r=n._journal.length;return e==r?null:(t.last_update[0]=e,t.last_update[1]=r,{c:n._journal.slice(e,r),start:e,end:r,version:t.version})},t.deltaClientToServer=function(t,n){n._done||(n._done={});try{if(!t.id)return;if(n._done[t.id])return res;n._done[t.id]=!0;for(var e=n.data,r=[],i=0;i<t.c.length;i++){var a=t.c[i],o=e.execCmd(a);o!==!0&&r.push(o)}return{errors:r}}catch(s){return s.message}},t.deltaServerToClient=function(t,n){var e=n.data;n.last_update||(n.last_update=[]);var r={goodCnt:0,oldCnt:0,newCnt:0,reverseCnt:0},i=t.start-1;if(!n.needsRefresh){if(t.start>e._journal.length)return n.needsRefresh=!0,r.fail=!0,r;if(n.client)for(var a=t.start;a<t.end;a++){var o=t.c[a-t.start];t.c[a-t.start]=n.client._transformCmdToNs(o)}for(var a=t.start;a<t.end;a++){var s=e.getJournalCmd(a),o=t.c[a-t.start],f=!0;if(s){for(var l=0;4>=l;l++)s[l]!=o[l]&&(f=!1);if(!f){e.reverseToLine(i);for(var a=i+1;a<t.end;a++){var o=t.c[a-t.start],c=e.execCmd(o,!0);if(c!==!0)return n.needsRefresh=!0,r.fail=!0,r.reason=c,r;r.reverseCnt++}n.last_update[0]=t.start,n.last_update[1]=t.end;break}i=a,r.goodCnt++,r.oldCnt++}else{var c=e.execCmd(o,!0);if(c!==!0)return n.needsRefresh=!0,r.fail=!0,r.reason=c,r;i=a,r.goodCnt++,r.newCnt++}}return r}}}(this)},e=function(t,n,r,i,a,o,s,f){var l,c=this;if(!(c instanceof e))return new e(t,n,r,i,a,o,s,f);var u=[t,n,r,i,a,o,s,f];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){l=t.apply(c,u)}),"function"==typeof l){if(l._classInfo.name!=e._classInfo.name)return new l(t,n,r,i,a,o,s,f)}else if(l)return l;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,u)}):"function"==typeof c.init&&c.init.apply(c,u)};e._classInfo={name:"_chPolicy"},e.prototype=new n,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t._chPolicy=e,this._chPolicy=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._chPolicy=e:this._chPolicy=e}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},e=function(t,n,r,i,a,o,s,f){var l,c=this;if(!(c instanceof e))return new e(t,n,r,i,a,o,s,f);var u=[t,n,r,i,a,o,s,f];if(c.__factoryClass)if(c.__factoryClass.forEach(function(t){l=t.apply(c,u)}),"function"==typeof l){if(l._classInfo.name!=e._classInfo.name)return new l(t,n,r,i,a,o,s,f)}else if(l)return l;c.__traitInit?c.__traitInit.forEach(function(t){t.apply(c,u)}):"function"==typeof c.init&&c.init.apply(c,u)};e._classInfo={name:"channelPolicyModule"},e.prototype=new n,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());